# 进行中
- 解决 18.04 使用 libncursew6 的问题
# [[待办]]
- 龙芯开发板适配
	- 问题：
		- 编译内核花费的时间太长了，想办法将其缩短。
		- kernel 和 buildroot 的 .config 动不动就几千行，实在是太蠢了。几千行的配置文件谁会去看？
		- 而且编译根文件系统的时间也太长了，太蠢了。
		- 接下来需要做的是用 yocto 来制作对应的根文件系统。需要找到一个合适的方法，将拉取镜像的资源，而不是去拉取外网的。找到 yocto 设置镜像的方式。
		- yocto 的编译出现了问题。先学习下 yocto 的使用，然后对 loong 的问题进行解决。
# 笔记
- 龙芯开发板适配
	- pmon 的编译
		- 先安装对应的程序，配置环境变量。
		- 其次，编译获得
			- `gzrom-dtb.bin`，`gzrom.bin`，`ls2k.dtb`
	- linux 内核编译
		- 步骤
			- `make ls2k1000_defconfig`
			- `make vmlinuz -j8`
		- 输出
			- `vmlinuz`
	- buildroot 编译 rootfs
		- 步骤
			- `make loongisa_defconfig`
			- `make menuconfig`
			- `make -j$(nproc)`
		- 输出
			- `rootfs.cpio`
			- `rootfs.cpio.gz`
	- pmon 烧录
		- 步骤 (ejtag)
			- `sudo ./la_dbg_tool_usb -t`
			- `source configs/config.ls2k`
			- `set`
			- 上电
			- `program_cachelock ./gzrom-dtb.bin`
	- 加载内核
		- 步骤 (手动)
			- `load (usb0,0)/vmlinuz`
			- `initrd (usb0,0)/rootfs.cpio.gz`
			- `g console=ttyS0,115200 rdinit=/sbin/init`
		- 步骤 （自动）
			- boot.cfg
	- `yocto` 编译
		- 构建 BSP 的流程
			-  `source poky/oe-init-build-env build-{name}`
			-  `bitbake-layers add-layer meta-{name}`
			- 查看`meta-{bsp name}/conf/machine` 支持的机器
			- 编辑 `conf/local.conf`
			- 查看 `meta-{bsp name}/recipes-core/image` 的配方。
			- `bitbake {配方}`
		- `yocto` 的命令：
			- `devtool/recipetool`：处理食谱的任务。
			- `bitbake-layers`：处理一般层级的任务。
				- `add-layer`：实际上处理的是在 `build-{name}/conf/bblayer.conf` 里增加层级关系。
				- `show-layers`：展示现在的层级关系。
			- `oe-pkgdata-util`：处理一般目标包的任务。
		- 食谱的结构：
			- 模型
				- `meta-{name}`
					- `conf`
						- `machine`：食谱匹配的设备。
					- `class/-recipe`
						- `bbclasss`: `IMAGE_FEATURES`
					- `recipes-core`
						- `image`
							- `bb`：可选择的配方。
						- `packagegroups`: `IMAGE_INSTALL_append`
						- `{program}`：其他菜谱。
			- 实例
				- `meta`
					- `recipes-core`
						- `image`
							- `core-image-minimal.bb`
						- `packagegroups`
							- `packagegroup-core-boot.bb`
					- `class-recipe`
						- `core-image.bbclass`
		- 构建系统的结构
			- `build-{name}` 
				- `conf`
					- `local.conf`
					- `bblayers.conf`
			- 创建一个系统需要两个配置的文件。使用 `source poky/oe-init-build-env build-rpi` 的时候会自动在对应的文件夹内创建下面两个文件。
		- 菜谱的结构：
			-  `{application}_{version}.bb
				- 属性
					- `SUMMARY`: 简单的描述这个菜是做什么的。
					- `DESCRIPTION`: 这个工具的介绍。
					- `HOMEPAGE`: 工具的主目录。
					- `SECTION`: 所属于的包组，base。
					- `LICENSE`: 许可证。
					- `SRC_URI`: 定义从哪和如何找到需要的工具源代码，可以是本地，也可以是外部的地址。
						- 语法: `scheme://url;param1;param2`
						- 包储存的地址：`$BUILDDIR/downloads` 
							- 可以由 `build-{name}/conf/local.conf` 中的 `DL_DIR` 进行改变。
						- 本地的包储存地址：`$BUILDDIR/tmp/work/`
					- `LIC_FILES_CHKSUM`: 许可证的位置和校验码。
					- `DEPENDS`: 构建时的依赖。
					- `RDEPENDS`: 运行时的依赖。
				- 任务
					- 流程图
						 - ![[Pasted image 20230512091857.png]]
					- 流程
						- `do_fetch`
						- `do_unpack`
						- `do_patch`
							- 文件会以 `.patch` 的形式存在于 `SRC_URI` 中。
							- 默认会用 `quilt` 来进行补丁的使用。可以通过 `PATCH_TOOL = ` 来进行指定。
							- `PATCH_TOOL`: 指定执行补丁的程序。
								- `quilt`：打补丁的程序，默认。
								- `git/patch`：打补丁的程序。
							- `PATCHRESOLVE`: 指定补丁出现矛盾时的解决方法。
								- `noop`: 补丁未打上，构建失败。默认。
								- `user`: 补丁未打上弹出终端，来手动解决矛盾。
						- `do_configure`
						- `do_compile`
						- `do_install`
						- `do_package`
						- `do_rootfs`
					- 文件
						- `WORKDIR`: 食谱的工作目录。
						- `S`: 源文件的到处文件夹。
						- `B`: 构建时编译目标的地址。
						- `D`: 目标文件夹，创建镜像前，安装文件的根文件系统目录。

# [[已解决]]

# [[存档]]